name: Multi-Platform Build

on:
  workflow_dispatch:
  push:
    tags:
      - 'v*'

env:
  FLUTTER_VERSION: "3.24.0"
  VERSION_TAG: "v1.1.0"

jobs:
  # iOS æ„å»º
  build-ios:
    name: iOS Build
    runs-on: macos-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          architecture: x64

      - name: Install Dependencies
        run: flutter pub get

      - name: Update CocoaPods
        run: pod repo update
        working-directory: ios

      - name: Build iOS Release
        run: flutter build ios --release --no-codesign

      - name: Create IPA
        run: |
          mkdir Payload
          mv Runner.app/ Payload
          zip -qq -r -9 AgrisaleWS-ios-${{ env.VERSION_TAG }}.ipa Payload
        working-directory: build/ios/iphoneos

      - name: Upload iOS Artifact
        uses: actions/upload-artifact@v4
        with:
          name: iOS-Build
          path: build/ios/iphoneos/AgrisaleWS-ios-${{ env.VERSION_TAG }}.ipa

  # Android æ„å»º
  build-android:
    name: Android Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'

      - name: Install Dependencies
        run: flutter pub get

      - name: Clean Build
        run: flutter clean

      - name: Get Dependencies Again
        run: flutter pub get

      - name: Fix share_plus build.gradle
        run: |
          python3 << 'PYEOF'
          import os
          import re
          
          # ä¿®å¤ share_plus æ’ä»¶çš„ build.gradle æ–‡ä»¶
          share_plus_build_gradle = os.path.join(os.path.expanduser('~'), '.pub-cache', 'hosted', 'pub.dev', 'share_plus-12.0.1', 'android', 'build.gradle')
          if os.path.isfile(share_plus_build_gradle):
              print(f'æ‰¾åˆ° share_plus build.gradle: {share_plus_build_gradle}')
              with open(share_plus_build_gradle, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              # ä¿®å¤ compileSdk = flutter.compileSdkVersion ä¸º compileSdk = 35
              if 'compileSdk = flutter.compileSdkVersion' in content:
                  new_content = content.replace('compileSdk = flutter.compileSdkVersion', 'compileSdk = 35')
                  with open(share_plus_build_gradle, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ä¿®å¤ share_plus compileSdk é…ç½®')
              elif 'compileSdk flutter.compileSdkVersion' in content:
                  new_content = content.replace('compileSdk flutter.compileSdkVersion', 'compileSdk 35')
                  with open(share_plus_build_gradle, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ä¿®å¤ share_plus compileSdk é…ç½®')
              elif 'compileSdkVersion flutter.compileSdkVersion' in content:
                  new_content = content.replace('compileSdkVersion flutter.compileSdkVersion', 'compileSdkVersion 35')
                  with open(share_plus_build_gradle, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ä¿®å¤ share_plus compileSdkVersion é…ç½®')
              else:
                  print('âœ“ share_plus build.gradle ä¸­æœªå‘ç°éœ€è¦ä¿®å¤çš„ compileSdk é…ç½®')
          else:
              print(f'è­¦å‘Š: æœªæ‰¾åˆ° share_plus build.gradle: {share_plus_build_gradle}')
          PYEOF

      - name: Fix install_plugin namespace and AndroidManifest
        run: |
          python3 << 'PYEOF'
          import re
          import os
          
          home = os.environ.get('HOME', os.path.expanduser('~'))
          
          # ä¿®å¤ build.gradle - æ·»åŠ  namespace å’Œç»Ÿä¸€ JVM ç›®æ ‡ç‰ˆæœ¬
          build_gradle_path = os.path.join(home, '.pub-cache', 'hosted', 'pub.dev', 'install_plugin-2.1.0', 'android', 'build.gradle')
          if os.path.isfile(build_gradle_path):
              print(f'æ‰¾åˆ° build.gradle: {build_gradle_path}')
              with open(build_gradle_path, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              has_changes = False
              
              # æ·»åŠ  namespace
              if 'namespace' not in content:
                  pattern = r'(android\s*\{)'
                  replacement = r'\1\n    namespace "com.crazecoder.openfile"'
                  content = re.sub(pattern, replacement, content, count=1)
                  has_changes = True
                  print('âœ“ å·²æ·»åŠ  namespace åˆ° build.gradle')
              else:
                  print('âœ“ build.gradle å·²åŒ…å« namespace')
              
              # ä¿®å¤ compileSdkVersion - ç¡®ä¿è‡³å°‘ä¸º 30ï¼ˆJava 9+ è¦æ±‚ï¼‰ï¼Œæœ€å¥½è®¾ç½®ä¸º 35
              if 'compileSdkVersion' in content:
                  # æ£€æŸ¥å½“å‰çš„ compileSdkVersion å€¼
                  match = re.search(r'compileSdkVersion\s+(\d+)', content)
                  if match:
                      current_sdk = int(match.group(1))
                      if current_sdk < 35:
                          content = re.sub(r'compileSdkVersion\s+\d+', 'compileSdkVersion 35', content)
                          has_changes = True
                          print(f'âœ“ å·²æ›´æ–° compileSdkVersion ä» {current_sdk} åˆ° 35')
                      else:
                          print(f'âœ“ compileSdkVersion å·²è®¾ç½®ä¸º {current_sdk}')
                  else:
                      # å¦‚æœæ ¼å¼ä¸åŒï¼Œå°è¯•æ›¿æ¢
                      content = re.sub(r'compileSdkVersion\s*[^\n]+', 'compileSdkVersion 35', content)
                      has_changes = True
                      print('âœ“ å·²è®¾ç½® compileSdkVersion ä¸º 35')
              else:
                  # å¦‚æœæ²¡æœ‰ compileSdkVersionï¼Œæ·»åŠ å®ƒï¼ˆåœ¨ namespace ä¹‹åï¼‰
                  if 'namespace' in content:
                      pattern = r'(namespace\s+"[^"]+"\s*\n)'
                      replacement = r'\1    compileSdkVersion 35\n'
                      content = re.sub(pattern, replacement, content, count=1)
                      has_changes = True
                      print('âœ“ å·²æ·»åŠ  compileSdkVersion 35')
                  elif 'android {' in content:
                      pattern = r'(android\s*\{)'
                      replacement = r'\1\n    compileSdkVersion 35'
                      content = re.sub(pattern, replacement, content, count=1)
                      has_changes = True
                      print('âœ“ å·²æ·»åŠ  compileSdkVersion 35')
              
              # ç»Ÿä¸€ JVM ç›®æ ‡ç‰ˆæœ¬ä¸º 11ï¼ˆä¸é¡¹ç›®é…ç½®ä¸€è‡´ï¼‰
              # ä¿®å¤ compileOptions - å°† Java 1.8 æ”¹ä¸º 11
              if 'VERSION_1_8' in content:
                  content = re.sub(r'VERSION_1_8', 'VERSION_11', content)
                  has_changes = True
                  print('âœ“ å·²æ›´æ–° Java ç‰ˆæœ¬ä» 1.8 åˆ° 11')
              
              # ä¿®å¤ kotlinOptions - å°† jvmTarget 1.8 æ”¹ä¸º 11
              if 'jvmTarget' in content:
                  # åŒ¹é… jvmTarget = "1.8" æˆ– jvmTarget = '1.8'
                  content = re.sub(r'jvmTarget\s*=\s*["\']1\.8["\']', 'jvmTarget = "11"', content)
                  if 'jvmTarget = "11"' in content or "jvmTarget = '11'" in content:
                      print('âœ“ kotlinOptions jvmTarget å·²è®¾ç½®ä¸º 11')
                  else:
                      has_changes = True
                      print('âœ“ å·²æ›´æ–° kotlinOptions jvmTarget åˆ° 11')
              
              # å¦‚æœæ²¡æœ‰ compileOptionsï¼Œæ·»åŠ å®ƒ
              if 'compileOptions' not in content and 'android {' in content:
                  # åœ¨ android { åæ·»åŠ  compileOptions
                  pattern = r'(android\s*\{)'
                  replacement = r'\1\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_11\n        targetCompatibility JavaVersion.VERSION_11\n    }'
                  content = re.sub(pattern, replacement, content, count=1)
                  has_changes = True
                  print('âœ“ å·²æ·»åŠ  compileOptions é…ç½®')
              
              # å¦‚æœæ²¡æœ‰ kotlinOptionsï¼Œæ·»åŠ å®ƒ
              if 'kotlinOptions' not in content and 'compileOptions' in content:
                  # åœ¨ compileOptions åæ·»åŠ  kotlinOptions
                  pattern = r'(compileOptions\s*\{[^\}]*?\})'
                  replacement = r'\1\n    kotlinOptions {\n        jvmTarget = "11"\n    }'
                  content = re.sub(pattern, replacement, content, count=1)
                  has_changes = True
                  print('âœ“ å·²æ·»åŠ  kotlinOptions é…ç½®')
              
              if has_changes:
                  with open(build_gradle_path, 'w', encoding='utf-8') as f:
                      f.write(content)
                  print('âœ“ build.gradle ä¿®å¤å®Œæˆ')
          else:
              print(f'è­¦å‘Š: æœªæ‰¾åˆ° build.gradle: {build_gradle_path}')
          
          # ä¿®å¤ AndroidManifest.xml - ç§»é™¤ package å±æ€§
          manifest_path = os.path.join(home, '.pub-cache', 'hosted', 'pub.dev', 'install_plugin-2.1.0', 'android', 'src', 'main', 'AndroidManifest.xml')
          if os.path.isfile(manifest_path):
              print(f'æ‰¾åˆ° AndroidManifest.xml: {manifest_path}')
              with open(manifest_path, 'r', encoding='utf-8') as f:
                  content = f.read()
              
              # ç§»é™¤ package å±æ€§
              if 'package=' in content:
                  # åŒ¹é… package="..." æˆ– package='...'
                  pattern = r'\s*package\s*=\s*["\'][^"\']*["\']'
                  new_content = re.sub(pattern, '', content)
                  
                  with open(manifest_path, 'w', encoding='utf-8') as f:
                      f.write(new_content)
                  print('âœ“ å·²ç§»é™¤ AndroidManifest.xml ä¸­çš„ package å±æ€§')
              else:
                  print('âœ“ AndroidManifest.xml ä¸­å·²æ—  package å±æ€§')
          else:
              print(f'è­¦å‘Š: æœªæ‰¾åˆ° AndroidManifest.xml: {manifest_path}')
          PYEOF

      - name: Restore Android keystore
        run: |
          echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 --decode > android/app/agrisale-release.jks
          chmod 600 android/app/agrisale-release.jks

      - name: Verify keystore and alias
        run: |
          echo "=== éªŒè¯æ¢å¤çš„ keystore ==="
          if [ ! -f "android/app/agrisale-release.jks" ]; then
            echo "âŒ Keystore æ–‡ä»¶ä¸å­˜åœ¨"
            exit 1
          fi
          echo "âœ… Keystore æ–‡ä»¶å­˜åœ¨"
          echo ""
          echo "=== æ£€æŸ¥ keystore ä¸­çš„ alias ==="
          keytool -list -keystore android/app/agrisale-release.jks -storepass "${{ secrets.ANDROID_STORE_PASSWORD }}" 2>&1 | grep -E "agrisale|Alias name" || echo "âŒ æ— æ³•åˆ—å‡º aliasï¼ˆå¯èƒ½æ˜¯å¯†ç é”™è¯¯ï¼‰"
          echo ""
          echo "=== é…ç½®çš„ alias (æ¥è‡ª Secret) ==="
          echo "ANDROID_KEY_ALIAS=${{ secrets.ANDROID_KEY_ALIAS }}"
          echo ""
          echo "=== éªŒè¯ alias æ˜¯å¦åŒ¹é… ==="
          KEYSTORE_ALIAS=$(keytool -list -keystore android/app/agrisale-release.jks -storepass "${{ secrets.ANDROID_STORE_PASSWORD }}" 2>&1 | grep -oP "agrisale\w*" | head -1)
          SECRET_ALIAS="${{ secrets.ANDROID_KEY_ALIAS }}"
          if [ "$KEYSTORE_ALIAS" = "$SECRET_ALIAS" ]; then
            echo "âœ… Alias åŒ¹é…: $KEYSTORE_ALIAS"
          else
            echo "âŒ Alias ä¸åŒ¹é…ï¼"
            echo "   Keystore ä¸­çš„ alias: $KEYSTORE_ALIAS"
            echo "   Secret ä¸­çš„ alias: $SECRET_ALIAS"
            exit 1
          fi

      - name: Create key.properties
        run: |
          echo "storePassword=${{ secrets.ANDROID_STORE_PASSWORD }}" > android/key.properties
          echo "keyPassword=${{ secrets.ANDROID_KEY_PASSWORD }}" >> android/key.properties
          echo "keyAlias=${{ secrets.ANDROID_KEY_ALIAS }}" >> android/key.properties
          echo "storeFile=agrisale-release.jks" >> android/key.properties
          echo ""
          echo "=== ç”Ÿæˆçš„ key.properties å†…å®¹ ==="
          cat android/key.properties

      - name: Build Android APK
        run: flutter build apk --release

      - name: Rename APK File
        run: |
          mv build/app/outputs/flutter-apk/app-release.apk build/app/outputs/flutter-apk/AgrisaleWS-android-${{ env.VERSION_TAG }}.apk

      - name: Upload Android APK
        uses: actions/upload-artifact@v4
        with:
          name: Android-APK
          path: build/app/outputs/flutter-apk/AgrisaleWS-android-${{ env.VERSION_TAG }}.apk

  # macOS æ„å»º
  build-macos:
    name: macOS Build
    runs-on: macos-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          architecture: x64

      - name: Enable macOS Desktop
        run: flutter config --enable-macos-desktop

      - name: Install Dependencies
        run: flutter pub get

      - name: Update CocoaPods
        run: pod repo update
        working-directory: macos

      - name: Build macOS Release
        run: flutter build macos --release

      - name: Create macOS Archive
        run: |
          cd build/macos/Build/Products/Release
          zip -qq -r -9 ../../../../../AgrisaleWS-macos-${{ env.VERSION_TAG }}.zip AgrisaleWS.app

      - name: Upload macOS Artifact
        uses: actions/upload-artifact@v4
        with:
          name: macOS-Build
          path: AgrisaleWS-macos-${{ env.VERSION_TAG }}.zip

  # Windows æ„å»º
  build-windows:
    name: Windows Build
    runs-on: windows-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'

      - name: Enable Windows Desktop
        run: flutter config --enable-windows-desktop

      - name: Install Dependencies
        run: flutter pub get

      - name: Build Windows Release
        run: flutter build windows --release

      - name: Create Windows Archive
        run: |
          Compress-Archive -Path "build\windows\x64\runner\Release\*" -DestinationPath "AgrisaleWS-windows-${{ env.VERSION_TAG }}.zip"

      - name: Upload Windows Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Windows-Build
          path: AgrisaleWS-windows-${{ env.VERSION_TAG }}.zip

  # åˆ›å»º GitHub Release
  create-release:
    name: Create Release
    needs: [build-ios, build-android, build-macos, build-windows]
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch' || startsWith(github.ref, 'refs/tags/')
    steps:
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: artifacts

      - name: Display structure of downloaded files
        run: ls -la artifacts/

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ env.VERSION_TAG }}
          name: "AgrisaleWS ${{ env.VERSION_TAG }}"
          body: |
            ## AgrisaleWS ${{ env.VERSION_TAG }}
            
            ### æ”¯æŒå¹³å°
            - iOS: iPhone å’Œ iPad
            - Android: æ‰‹æœºå’Œå¹³æ¿
            - macOS: Mac æ¡Œé¢åº”ç”¨
            - Windows: Windows æ¡Œé¢åº”ç”¨
            
            ### v1.1.0 æ›´æ–°å†…å®¹ ğŸš€
            
            #### ğŸ› Bug ä¿®å¤
            - **æ•°æ®åˆ é™¤åŠŸèƒ½ä¿®å¤**ï¼šä¿®å¤äº†é‡‡è´­è®°å½•å’Œé”€å”®è®°å½•åˆ é™¤æ—¶æ˜¾ç¤ºæˆåŠŸä½†å®é™…æœªåˆ é™¤çš„ä¸¥é‡bug
            - **è¿›è´¦è®°å½•åˆ é™¤ä¿®å¤**ï¼šä¿®å¤äº†äº‘ç«¯workspaceè¿›è´¦è®°å½•åˆ é™¤åŠŸèƒ½ç¼ºå¤±workspaceæ”¯æŒçš„é—®é¢˜
            - **æ•°æ®å¤‡ä»½æ¢å¤ä¿®å¤**ï¼šä¿®å¤äº†å¤‡ä»½æ¢å¤åŠŸèƒ½ä¸­çš„æƒé™æ£€æŸ¥é—®é¢˜ï¼Œç°åœ¨ç®¡ç†å‘˜å¯ä»¥æ­£å¸¸æ¢å¤å¤‡ä»½
            - **æ—¶é—´æ˜¾ç¤ºä¿®å¤**ï¼šç»Ÿä¸€æ‰€æœ‰æ—¶é—´æ˜¾ç¤ºä¸ºUTC+8ï¼ˆä¸­å›½æ ‡å‡†æ—¶é—´ï¼‰ï¼Œç¡®ä¿æ—¶é—´æ˜¾ç¤ºå‡†ç¡®ä¸€è‡´
            
            #### âœ¨ åŠŸèƒ½æ”¹è¿›
            - **æ—¥å¿—æ˜¾ç¤ºä¼˜åŒ–**ï¼š
              - è¿›è´¦è®°å½•æ—¥å¿—ç°åœ¨æ˜¾ç¤ºå®¢æˆ·åç§°è€Œä¸æ˜¯"è¿›è´¦è®°å½•"
              - æ±‡æ¬¾è®°å½•æ—¥å¿—ç°åœ¨æ˜¾ç¤ºä¾›åº”å•†åç§°è€Œä¸æ˜¯"æ±‡æ¬¾è®°å½•"
              - è¦†ç›–æ“ä½œçš„å¤‡æ³¨ä¿¡æ¯ç»Ÿä¸€ä½¿ç”¨æ™®é€šå­—ä½“ï¼Œä¸å†ä½¿ç”¨æ–œä½“
            - **æ—¥å¿—è¯¦æƒ…å¢å¼º**ï¼š
              - å¤‡ä»½æ¢å¤è®°å½•æ˜¾ç¤º"æ¢å¤å‰æ•°æ®"å’Œ"æ¢å¤åæ•°æ®"
              - æ•°æ®å¯¼å…¥è®°å½•æ˜¾ç¤º"å¯¼å…¥å‰æ•°æ®"å’Œ"å¯¼å…¥åæ•°æ®"
              - æ‰€æœ‰è¦†ç›–æ“ä½œéƒ½åŒ…å«å®Œæ•´çš„æ•°æ®å¯¹æ¯”ä¿¡æ¯
            
            #### ğŸ”§ æŠ€æœ¯æ”¹è¿›
            - å®Œå–„äº†æ‰€æœ‰åˆ é™¤æ“ä½œçš„workspaceæ”¯æŒ
            - ä¼˜åŒ–äº†æ—¥å¿—è®°å½•çš„entity_nameæ˜¾ç¤ºé€»è¾‘
            - æ”¹è¿›äº†æ•°æ®å¯¼å…¥/æ¢å¤çš„æ—¥å¿—è®°å½•å®Œæ•´æ€§
            
            ---
            
            ### v1.0.0 é¦–ä¸ªæ­£å¼ç‰ˆæœ¬ ğŸ‰
            
            **AgrisaleWS** æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å†œèµ„ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šå¹³å°ä½¿ç”¨ï¼Œæä¾›å®Œæ•´çš„ä¸šåŠ¡ç®¡ç†å’Œæ•°æ®åˆ†æåŠŸèƒ½ã€‚
            
            #### æ ¸å¿ƒåŠŸèƒ½
            
            **ğŸ¢ Workspace å·¥ä½œç©ºé—´ç®¡ç†**
            - æ”¯æŒåˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„å·¥ä½œç©ºé—´ï¼ˆWorkspaceï¼‰ï¼Œå®ç°ä¸šåŠ¡æ•°æ®éš”ç¦»
            - æœ¬åœ° Workspaceï¼šæ•°æ®å­˜å‚¨åœ¨æœ¬åœ°è®¾å¤‡ï¼Œéšç§æ€§å¼º
            - äº‘ç«¯ Workspaceï¼šæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œæ”¯æŒå¤šè®¾å¤‡è®¿é—®å’Œå›¢é˜Ÿåä½œ
            - çµæ´»çš„æˆå‘˜ç®¡ç†å’Œè§’è‰²æƒé™ç³»ç»Ÿï¼ˆæ‹¥æœ‰è€…ã€ç®¡ç†å‘˜ã€ç¼–è¾‘è€…ã€æŸ¥çœ‹è€…ï¼‰
            
            **ğŸ“Š ä¸šåŠ¡æ•°æ®ç®¡ç†**
            - äº§å“ç®¡ç†ï¼šäº§å“ä¿¡æ¯ã€åº“å­˜ç®¡ç†ã€ä¾›åº”å•†å…³è”
            - å®¢æˆ·ç®¡ç†ï¼šå®¢æˆ·ä¿¡æ¯ã€é”€å”®è®°å½•ã€è¿›è´¦ç»Ÿè®¡
            - ä¾›åº”å•†ç®¡ç†ï¼šä¾›åº”å•†ä¿¡æ¯ã€é‡‡è´­è®°å½•ã€æ±‡æ¬¾ç»Ÿè®¡
            - å‘˜å·¥ç®¡ç†ï¼šå‘˜å·¥ä¿¡æ¯ã€ç»æ‰‹äººè®°å½•
            - é‡‡è´­ç®¡ç†ï¼šé‡‡è´­è®°å½•ã€åº“å­˜è‡ªåŠ¨æ›´æ–°ã€ä¾›åº”å•†å…³è”
            - é”€å”®ç®¡ç†ï¼šé”€å”®è®°å½•ã€åº“å­˜æ£€æŸ¥ã€å®¢æˆ·å…³è”
            - é€€è´§ç®¡ç†ï¼šé€€è´§è®°å½•ã€åº“å­˜æ¢å¤
            - è¿›è´¦ç®¡ç†ï¼šæ”¶æ¬¾è®°å½•ã€ä¼˜æƒ è®¡ç®—ã€æ”¯ä»˜æ–¹å¼
            - æ±‡æ¬¾ç®¡ç†ï¼šä»˜æ¬¾è®°å½•ã€ä¾›åº”å•†å…³è”
            
            **ğŸ“ˆ æ•°æ®ç»Ÿè®¡ä¸åˆ†æ**
            - åŸºç¡€ç»Ÿè®¡ï¼šåº“å­˜ç»Ÿè®¡ã€é‡‡è´­ç»Ÿè®¡ã€é”€å”®ç»Ÿè®¡ã€é€€è´§ç»Ÿè®¡
            - ç»¼åˆåˆ†æï¼šé”€å”®æ±‡æ€»ã€é”€å”®ä¸è¿›è´¦åˆ†æã€é‡‡è´­ä¸æ±‡æ¬¾åˆ†æã€è´¢åŠ¡ç»Ÿè®¡
            - æ™ºèƒ½åˆ†æï¼šæ•°æ®ä»ªè¡¨ç›˜ã€AI æ•°æ®åˆ†æåŠ©æ‰‹ï¼ˆæ”¯æŒ DeepSeekï¼‰
            - å¯è§†åŒ–å›¾è¡¨ï¼šè¶‹åŠ¿å›¾ã€å¯¹æ¯”å›¾ã€å æ¯”å›¾ã€å¤šç»´åº¦æ•°æ®å±•ç¤º
            - æ•°æ®å¯¼å‡ºï¼šæ”¯æŒ CSV å’Œ PDF æ ¼å¼å¯¼å‡º
            
            **ğŸ’¾ æ•°æ®ç®¡ç†ä¸å¤‡ä»½**
            - Workspace çº§åˆ«çš„æ•°æ®å¯¼å…¥å¯¼å‡ºï¼ˆJSON æ ¼å¼ï¼‰
            - è‡ªåŠ¨å¤‡ä»½ç³»ç»Ÿï¼šæ”¯æŒå®šæ—¶å¤‡ä»½ã€å¯åŠ¨/é€€å‡ºæ—¶å¤‡ä»½
            - å¤‡ä»½ç®¡ç†ï¼šæŸ¥çœ‹ã€æ¢å¤ã€åˆ é™¤å¤‡ä»½æ–‡ä»¶
            - æ•°æ®è¿ç§»ï¼šæ”¯æŒè·¨ Workspace æ•°æ®å¯¼å…¥
            - å…¼å®¹æ—§ç‰ˆæœ¬æ•°æ®æ ¼å¼
            
            **ğŸ“ å®¡è®¡æ—¥å¿—**
            - å®Œæ•´è®°å½•æ‰€æœ‰æ“ä½œï¼ˆåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ï¼‰
            - Workspace çº§åˆ«çš„æ—¥å¿—éš”ç¦»
            - å¤šç»´åº¦ç­›é€‰ï¼šæŒ‰æ“ä½œç±»å‹ã€å®ä½“ç±»å‹ã€æ—¶é—´èŒƒå›´ã€æ“ä½œäºº
            - è¯¦ç»†çš„å˜æ›´è®°å½•ï¼šæ˜¾ç¤ºä¿®æ”¹å‰åçš„æ•°æ®å¯¹æ¯”
            - æ“ä½œè¿½æº¯ï¼šæŸ¥çœ‹è°ã€ä½•æ—¶ã€åšäº†ä»€ä¹ˆ
            
            **ğŸ‘¥ å›¢é˜Ÿåä½œ**
            - æˆå‘˜é‚€è¯·ï¼šé€šè¿‡ç”¨æˆ·åé‚€è¯·æˆå‘˜åŠ å…¥äº‘ç«¯ Workspace
            - è§’è‰²æƒé™ï¼šå››ç§è§’è‰²ï¼ˆæ‹¥æœ‰è€…ã€ç®¡ç†å‘˜ã€ç¼–è¾‘è€…ã€æŸ¥çœ‹è€…ï¼‰
            - å®æ—¶æƒé™æ£€æŸ¥ï¼šåŠ¨æ€éªŒè¯ç”¨æˆ·æƒé™
            - æˆå‘˜ç®¡ç†ï¼šä¿®æ”¹è§’è‰²ã€ç§»é™¤æˆå‘˜
            - æ‰€æœ‰æƒè½¬ç§»ï¼šåˆ é™¤è´¦æˆ·æ—¶è‡ªåŠ¨è½¬ç§» Workspace æ‰€æœ‰æƒ
            
            **âš™ï¸ ç³»ç»Ÿè®¾ç½®**
            - è´¦æˆ·ç®¡ç†ï¼šä¿®æ”¹å¯†ç ã€åœ¨çº¿è®¾å¤‡ç®¡ç†ã€é€€å‡ºç™»å½•ã€æ³¨é”€è´¦æˆ·
            - AI æ¨¡å‹é…ç½®ï¼šDeepSeek API è®¾ç½®ã€æ¨¡å‹å‚æ•°è°ƒæ•´
            - æœåŠ¡å™¨é…ç½®ï¼šè‡ªå®šä¹‰æœåŠ¡å™¨åœ°å€ã€è¿æ¥æµ‹è¯•ã€å¿«é€Ÿé…ç½®
            - åœ¨çº¿è®¾å¤‡ï¼šè®¾å¤‡ä¸Šçº¿/ä¸‹çº¿é€šçŸ¥ã€åœ¨çº¿è®¾å¤‡æ•°é‡æ˜¾ç¤º
            - å¸®åŠ©æ–‡æ¡£ï¼šå®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’Œå¸¸è§é—®é¢˜è§£ç­”
            
            #### UI/UX ç‰¹æ€§
            - ğŸ¨ ç°ä»£åŒ–è®¾è®¡ï¼šç®€æ´ç¾è§‚çš„ç•Œé¢ï¼Œç¬¦åˆ Material Design è§„èŒƒ
            - ğŸ·ï¸ å½©è‰²æ ‡è¯†ï¼šè§’è‰²æƒé™ã€å­˜å‚¨ç±»å‹ã€æ“ä½œç±»å‹ç­‰éƒ½æœ‰ç‹¬ç‰¹çš„é¢œè‰²æ ‡è¯†
            - ğŸ”„ è½®è½¬å¼ç­›é€‰ï¼šå¿«é€Ÿåˆ‡æ¢ä¸åŒçš„ç­›é€‰æ¡ä»¶
            - âš¡ å¹¶è¡ŒåŠ è½½ï¼šå¤šä¸ªæ•°æ®æºåŒæ—¶åŠ è½½ï¼Œæå‡æ€§èƒ½
            - ğŸ“± å“åº”å¼è®¾è®¡ï¼šé€‚é…å„ç§å±å¹•å°ºå¯¸
            - ğŸ• UTC+8 æ—¶åŒºï¼šç»Ÿä¸€ä½¿ç”¨ä¸­å›½æ ‡å‡†æ—¶é—´æ˜¾ç¤º
            
            #### å®‰å…¨ç‰¹æ€§
            - ğŸ”’ å¯†ç éªŒè¯ï¼šé‡è¦æ“ä½œï¼ˆåˆ é™¤ Workspaceã€æ³¨é”€è´¦æˆ·ï¼‰éœ€è¦å¯†ç ç¡®è®¤
            - ğŸ” æƒé™æ§åˆ¶ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
            - ğŸ“Š å®¡è®¡è¿½è¸ªï¼šå®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•
            - ğŸ’¾ æ•°æ®éš”ç¦»ï¼šWorkspace çº§åˆ«çš„æ•°æ®å’Œæ—¥å¿—éš”ç¦»
            - ğŸ”„ è‡ªåŠ¨å¤‡ä»½ï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±
            
            #### æŠ€æœ¯äº®ç‚¹
            - Flutter è·¨å¹³å°æ¡†æ¶ï¼ŒåŸç”Ÿæ€§èƒ½ä½“éªŒ
            - SQLite æœ¬åœ°æ•°æ®åº“ï¼Œæ”¯æŒç¦»çº¿ä½¿ç”¨
            - RESTful API åç«¯æœåŠ¡
            - JWT èº«ä»½è®¤è¯
            - å®æ—¶å¿ƒè·³æœºåˆ¶
            - æ•°æ®åº“äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§
            
            
            ### ğŸ“¥ ä¸‹è½½è¯´æ˜
            - **iOS ç”¨æˆ·**: ä¸‹è½½ `AgrisaleWS-ios-${{ env.VERSION_TAG }}.ipa` æ–‡ä»¶
            - **Android ç”¨æˆ·**: ä¸‹è½½ `AgrisaleWS-android-${{ env.VERSION_TAG }}.apk` æ–‡ä»¶
            - **macOS ç”¨æˆ·**: ä¸‹è½½ `AgrisaleWS-macos-${{ env.VERSION_TAG }}.zip` æ–‡ä»¶
            - **Windows ç”¨æˆ·**: ä¸‹è½½ `AgrisaleWS-windows-${{ env.VERSION_TAG }}.zip` æ–‡ä»¶
            
            ### ğŸ“² å®‰è£…è¯´æ˜
            - **iOS**: éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å¦‚ AltStore æˆ–ä¼ä¸šè¯ä¹¦å®‰è£…
            - **Android**: å¼€å¯"æœªçŸ¥æ¥æºåº”ç”¨"åç›´æ¥å®‰è£… APK
            - **macOS**: è§£å‹åæ‹–æ‹½åˆ°åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ï¼Œé¦–æ¬¡æ‰“å¼€å¯èƒ½éœ€è¦åœ¨"ç³»ç»Ÿåå¥½è®¾ç½®-å®‰å…¨æ€§ä¸éšç§"ä¸­å…è®¸
            - **Windows**: è§£å‹åè¿è¡Œ AgrisaleWS.exe
            
            ### ğŸš€ å¿«é€Ÿå¼€å§‹
            1. æ³¨å†Œè´¦å·æˆ–ç™»å½•
            2. åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ª Workspaceï¼ˆé€‰æ‹©æœ¬åœ°æˆ–äº‘ç«¯ï¼‰
            3. æ·»åŠ äº§å“ã€å®¢æˆ·ã€ä¾›åº”å•†ç­‰åŸºç¡€æ•°æ®
            4. å¼€å§‹è®°å½•é‡‡è´­ã€é”€å”®ç­‰ä¸šåŠ¡æ•°æ®
            5. æŸ¥çœ‹ç»Ÿè®¡æŠ¥è¡¨å’Œæ•°æ®åˆ†æ
            
            ### ğŸ“š ä½¿ç”¨å¸®åŠ©
            - è¯¦ç»†çš„å¸®åŠ©æ–‡æ¡£ï¼šåº”ç”¨å†…"ä¸ªäººä¸­å¿ƒ" â†’ "è®¾ç½®" â†’ "å…³äº" â†’ "æŸ¥çœ‹å¸®åŠ©"
            - æ¶µç›–æ‰€æœ‰åŠŸèƒ½çš„å®Œæ•´ä½¿ç”¨æŒ‡å—
            - å¸¸è§é—®é¢˜è§£ç­”å’Œä½¿ç”¨æŠ€å·§
            
            ---
            
            âœ¨ **å®Œæ•´è·¨å¹³å°æ”¯æŒ** | ğŸ¯ **åŸç”Ÿç”¨æˆ·ä½“éªŒ** | ğŸ’¼ **ä¸“ä¸šä¸šåŠ¡ç®¡ç†** | ğŸ†“ **å¼€æºå…è´¹**
          files: |
            artifacts/iOS-Build/AgrisaleWS-ios-${{ env.VERSION_TAG }}.ipa
            artifacts/Android-APK/AgrisaleWS-android-${{ env.VERSION_TAG }}.apk
            artifacts/macOS-Build/AgrisaleWS-macos-${{ env.VERSION_TAG }}.zip
            artifacts/Windows-Build/AgrisaleWS-windows-${{ env.VERSION_TAG }}.zip
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

